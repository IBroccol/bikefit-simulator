<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Добавить антропометрию</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/add_anthro.css') }}">
</head>
<body>
<div class="container anthro-container">
    <div class="top-bar">
        <button class="btn btn-primary" onclick="window.location.href='/dashboard'">В меню</button>
    </div>

    <h2>Антропометрические данные</h2>
    
    <form id="anthroForm" class="anthro-form">
        <div class="form-section">
            <h3>Основные параметры</h3>
            
            <div class="field-row">
                <div class="tooltip">?
                    <img src="static/png/hints/height.png" alt="Рост">
                </div>
                <span class="field-label">Рост, см</span>
                <div class="field-input">
                    <input type="number" step="1" name="height" required placeholder="170">
                </div>
            </div>
        </div>

        <div class="form-section">
            <h3>Нижние конечности</h3>
            
            <div class="field-row">
                <div class="tooltip">?
                    <img src="static/png/hints/hip.png" alt="Длина бедра">
                </div>
                <span class="field-label">Длина бедра, мм</span>
                <div class="field-input">
                    <input type="number" step="0.1" name="hip" required placeholder="450">
                </div>
            </div>

            <div class="field-row">
                <div class="tooltip">?
                    <img src="static/png/hints/lowerLeg.png" alt="Длина голени">
                </div>
                <span class="field-label">Длина голени, мм</span>
                <div class="field-input">
                    <input type="number" step="0.1" name="lowerLeg" required placeholder="400">
                </div>
            </div>

            <div class="field-row">
                <div class="tooltip">?
                    <img src="static/png/hints/footLength.png" alt="Длина стопы">
                </div>
                <span class="field-label">Длина стопы, мм</span>
                <div class="field-input">
                    <input type="number" step="0.1" name="footLength" required placeholder="260">
                </div>
            </div>
        </div>

        <div class="form-section">
            <h3>Верхние конечности и туловище</h3>
            
            <div class="field-row">
                <div class="tooltip">?
                    <img src="static/png/hints/torsoMax.png" alt="Длина туловища">
                </div>
                <span class="field-label">Длина туловища, мм</span>
                <div class="field-input">
                    <input type="number" step="0.1" name="torsoMax" required placeholder="600">
                </div>
            </div>

            <div class="field-row">
                <div class="tooltip">?
                    <img src="static/png/hints/upperarm.png" alt="Длина плеча">
                </div>
                <span class="field-label">Длина плеча, мм</span>
                <div class="field-input">
                    <input type="number" step="0.1" name="upperarm" required placeholder="320">
                </div>
            </div>

            <div class="field-row">
                <div class="tooltip">?
                    <img src="static/png/hints/forearm.png" alt="Длина предплечья">
                </div>
                <span class="field-label">Длина предплечья, мм</span>
                <div class="field-input">
                    <input type="number" step="0.1" name="forearm" required placeholder="280">
                </div>
            </div>
        </div>

        <div class="form-actions">
            <button type="submit" class="btn btn-success btn-lg">Сохранить данные</button>
        </div>
    </form>
</div>

<script>
document.getElementById("anthroForm").addEventListener("submit", async (e) => {
    e.preventDefault();
    const form = e.target;
    const formData = new FormData(form);

    const data = {};
    formData.forEach((value, key) => {
        data[key] = value ? parseFloat(value) : null;
    });

    try {
        const response = await fetch("/fits/add_anthropometry", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            credentials: "include",
            body: JSON.stringify(data)
        });

        const result = await response.json();
        if (response.ok) {
            alert("✅ Данные успешно сохранены!");
        } else {
            alert("❌ Ошибка: " + (result.error || "Не удалось сохранить"));
        }
    } catch (err) {
        console.error("Ошибка при отправке:", err);
        alert("❌ Ошибка при отправке данных на сервер");
    }
});

document.addEventListener('DOMContentLoaded', async () => {
    try {
        const response = await fetch('/fits/anthropometry');
        if (!response.ok) throw new Error('Ошибка при загрузке данных');
        const data = await response.json();

        if (data) {
            const form = document.getElementById('anthroForm');
            Object.keys(data).forEach(key => {
                const input = form.querySelector(`[name="${key}"]`);
                if (input && data[key] !== null) {
                    input.value = data[key];
                }
            });
        }
    } catch (err) {
        console.error('Не удалось загрузить данные:', err);
    }
});
</script>
</body>
</html>